<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HerWay | Interview Wings</title>
    <link rel="stylesheet" href="style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&family=Playfair+Display:ital,wght@0,700;1,700&display=swap"
        rel="stylesheet">
    <style>
        /* â”€â”€ Interview Wings Styles â”€â”€ */
        .interview-container {
            max-width: 800px;
            margin: 1rem auto;
            padding: 1.5rem 2rem;
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            border-radius: 24px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
        }

        .interview-hero {
            text-align: center;
            margin-bottom: 2rem;
        }

        .interview-hero .glow {
            width: 140px;
            height: 140px;
            background: var(--grad-primary);
            border-radius: 50%;
            margin: 0 auto;
            filter: blur(20px);
            opacity: 0.5;
            animation: pulse 3s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.5;
            }

            50% {
                transform: scale(1.1);
                opacity: 0.7;
            }
        }

        .interview-hero img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin-top: -130px;
            position: relative;
            border: 4px solid white;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .interview-title {
            font-family: 'Playfair Display', serif;
            font-size: 2.2rem;
            color: var(--secondary);
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .interview-subtitle {
            text-align: center;
            color: var(--text-muted);
            margin-bottom: 2rem;
            font-size: 1rem;
        }

        /* â”€â”€ Progress â”€â”€ */
        .progress-container {
            margin-bottom: 2rem;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(244, 114, 141, 0.15);
            border-radius: 10px;
            margin-bottom: 0.75rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--grad-primary);
            width: 0%;
            border-radius: 10px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            color: var(--text-muted);
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        /* â”€â”€ Score Card â”€â”€ */
        .score-card {
            background: var(--grad-primary);
            padding: 2.5rem;
            border-radius: 20px;
            color: white;
            text-align: center;
            margin-bottom: 2rem;
            display: none;
            box-shadow: 0 15px 40px rgba(244, 114, 141, 0.3);
        }

        .score-card.active {
            display: block;
            animation: fadeSlideIn 0.6s ease;
        }

        .score-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .score-number {
            font-size: 5rem;
            font-weight: 700;
            font-family: 'Playfair Display', serif;
            margin-bottom: 0.5rem;
        }

        .score-message {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* â”€â”€ Question Card â”€â”€ */
        .question-card {
            background: rgba(255, 255, 255, 0.7);
            border-left: 4px solid var(--terracotta);
            padding: 2rem;
            border-radius: 0 16px 16px 0;
            margin-bottom: 1.5rem;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
        }

        .question-number {
            background: var(--grad-primary);
            color: white;
            padding: 0.35rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .question-text {
            font-family: 'Playfair Display', serif;
            font-size: 1.25rem;
            color: var(--secondary);
            font-weight: 600;
            margin-bottom: 1.5rem;
            line-height: 1.7;
        }

        .answer-input {
            width: 100%;
            padding: 1.2rem;
            border: 2px solid var(--glass-border);
            border-radius: 16px;
            font-size: 1rem;
            font-family: 'Outfit', sans-serif;
            resize: vertical;
            min-height: 150px;
            margin-bottom: 1.25rem;
            background: rgba(255, 255, 255, 0.6);
            color: var(--secondary);
            transition: all 0.3s ease;
        }

        .answer-input:focus {
            outline: none;
            border-color: var(--terracotta);
            box-shadow: 0 0 0 4px rgba(244, 114, 141, 0.12);
            background: white;
        }

        .answer-input::placeholder {
            color: var(--text-muted);
            opacity: 0.6;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .submit-btn,
        .next-btn,
        .final-score-btn {
            color: white;
            padding: 0.9rem 2.5rem;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(244, 114, 141, 0.25);
        }

        .submit-btn {
            background: var(--grad-primary);
        }

        .next-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.25);
        }

        .final-score-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.25);
            margin: 1.5rem auto;
            display: none;
        }

        .submit-btn:hover,
        .next-btn:hover,
        .final-score-btn:hover {
            transform: translateY(-2px);
        }

        .submit-btn:disabled,
        .next-btn:disabled {
            background: #ddd;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* â”€â”€ Feedback â”€â”€ */
        .feedback-section {
            margin-top: 1.5rem;
            background: rgba(244, 114, 141, 0.06);
            border-left: 4px solid var(--terracotta);
            padding: 1.5rem;
            border-radius: 0 12px 12px 0;
            display: none;
        }

        .feedback-section.active {
            display: block;
            animation: fadeSlideIn 0.4s ease;
        }

        @keyframes fadeSlideIn {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .feedback-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            color: var(--secondary);
            font-weight: 600;
            font-size: 1.1rem;
        }

        .feedback-content {
            color: var(--secondary);
            line-height: 1.8;
            white-space: pre-wrap;
            font-size: 0.95rem;
        }

        .rating-badge {
            display: inline-block;
            padding: 0.35rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 1rem;
        }

        .rating-excellent {
            background: rgba(16, 185, 129, 0.15);
            color: #059669;
        }

        .rating-good {
            background: rgba(245, 158, 11, 0.15);
            color: #d97706;
        }

        .rating-needs-work {
            background: rgba(239, 68, 68, 0.15);
            color: #dc2626;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(244, 114, 141, 0.2);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .error-message {
            background: rgba(239, 68, 68, 0.08);
            border-left: 4px solid #ef4444;
            padding: 1rem 1.25rem;
            margin-bottom: 1.25rem;
            border-radius: 0 12px 12px 0;
            color: #ef4444;
            font-weight: 500;
            display: none;
        }

        .error-message.active {
            display: block;
            animation: fadeSlideIn 0.3s ease;
        }

        .all-done-box {
            text-align: center;
            padding: 2rem;
        }

        .all-done-box h3 {
            color: #059669;
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            margin-bottom: 0.75rem;
        }

        .all-done-box p {
            color: var(--text-muted);
        }
    </style>
</head>

<body>
    <canvas id="bg"></canvas>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-area" onclick="window.location.href='index.html'" style="cursor: pointer;">
                <img src="logo1.jpeg" alt="Her Way Logo" class="logo">
                <div class="logo-text-group">
                    <span class="brand-name" data-i18n="brand_name">Her Way</span>
                    <span class="tagline" data-i18n="tagline_main">"Empower. Equip. Elevate."</span>
                </div>
            </div>
            <nav class="header-nav">
                <a href="index.html" class="nav-link" data-i18n="home_btn">Home</a>
            </nav>
            <div class="header-right">
                <div id="google_translate_element"></div>
                <div class="user-control">
                    <span id="user-name-display" class="user-greeting"></span>
                    <button class="nav-icon profile-trigger" title="Profile">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                        </svg>
                    </button>
                    <button class="nav-icon logout-btn" title="Logout"
                        onclick="localStorage.removeItem('loggedInUser'); window.location.href='login.html'">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="interview-container">

            <!-- Hero -->
            <div class="interview-hero">
                <div class="glow"></div>
                <img src="Interview_Wings.png" alt="Interview Wings Logo">
            </div>

            <h1 class="interview-title">ðŸŽ¯ Interview Wings</h1>
            <p class="interview-subtitle">Answer one question at a time, just like a real interview</p>

            <!-- Progress Bar -->
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <div class="progress-text">
                    <span id="currentQuestionDisplay">Question 1 of 6</span>
                    <span id="scoreDisplay">Score: --/100</span>
                </div>
            </div>

            <!-- Score Card -->
            <div class="score-card" id="scoreCard">
                <div class="score-title">Your Interview Readiness Score</div>
                <div class="score-number" id="finalScore">0</div>
                <div class="score-message" id="scoreMessage"></div>
            </div>

            <div class="error-message" id="errorMessage"></div>

            <!-- Question Container -->
            <div id="questionContainer"></div>

            <!-- Final Score Button -->
            <button class="final-score-btn" id="finalScoreBtn" onclick="showFinalScore()" style="display: none;">View
                Your Final Score âœ¨</button>
        </div>
    </main>

    <script type="module" src="app.js"></script>
    <script>
        // â”€â”€ Secure: All Gemini calls routed through backend proxy â”€â”€
        const API_BASE = window.location.hostname === 'localhost'
            ? 'http://localhost:5000'
            : '';

        async function callGemini(prompt, maxOutputTokens = 500, temperature = 0.4) {
            const response = await fetch(`${API_BASE}/api/gemini/generate`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt, maxOutputTokens, temperature })
            });
            if (!response.ok) throw new Error(`Server error: ${response.status}`);
            const data = await response.json();
            return data.text || '';
        }

        // Initialize state
        let currentQuestionIndex = 0;
        let totalQuestions = 6;
        let answers = {};
        let scores = {};
        let feedbacks = {};
        let currentQuestions = [];
        let userSkills = "";
        let careerGoal = "";

        document.addEventListener('DOMContentLoaded', async () => {
            // Load user profile data
            const user = JSON.parse(localStorage.getItem('loggedInUser') || '{}');
            userSkills = Array.isArray(user.skills) ? user.skills.join(', ') : (user.skills || "");
            careerGoal = user.career_goal || localStorage.getItem('targetCareer') || "General Growth";

            const userNameEl = document.getElementById('user-name-display');
            if (userNameEl && user.name) userNameEl.textContent = user.name;

            // Start by generating the first question
            await generateAndLoadQuestion(0);
        });

        async function generateAndLoadQuestion(index) {
            const container = document.getElementById('questionContainer');
            if (index >= totalQuestions) {
                document.getElementById('finalScoreBtn').style.display = 'block';
                container.innerHTML = `
                    <div class="all-done-box">
                        <h3>âœ“ All Questions Answered!</h3>
                        <p>Click the button below to see your final interview readiness score.</p>
                    </div>
                `;
                return;
            }

            // Show loading state
            container.innerHTML = `
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">Question ${index + 1} of ${totalQuestions}</span>
                    </div>
                    <div style="text-align: center; padding: 2rem;">
                        <div class="loading-spinner" style="width: 40px; height: 40px; border-width: 4px;"></div>
                        <p style="margin-top: 1rem; color: var(--text-muted);">Generating a question based on your skills...</p>
                    </div>
                </div>
            `;

            try {
                // Generate question using Gemini
                const history = currentQuestions.join(' | ');
                const prompt = `You are a professional interviewer for a woman seeking growth in ${careerGoal}. 
                ${userSkills ? `Candidate's skills: ${userSkills}.` : 'Candidate is exploring foundational career skills.'}
                Generate ONE practical, challenging interview question to test their readiness for a role related to their goal and skills.
                Do NOT repeat these previous questions: ${history || 'none'}.
                REPLY WITH ONLY THE QUESTION TEXT.`;

                const questionText = await callGemini(prompt, 150, 0.7);
                const question = { id: index + 1, text: questionText || "Tell me about a time you solved a problem with a teammate." };

                currentQuestions.push(question.text);
                renderQuestion(index, question);
            } catch (error) {
                console.error('Question generation failed:', error);
                const fallback = { id: index + 1, text: "How do you handle difficult situations at work?" };
                renderQuestion(index, fallback);
            }
        }

        function renderQuestion(index, question) {
            const container = document.getElementById('questionContainer');
            const isAnswered = !!answers[question.id];

            container.innerHTML = `
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">Question ${index + 1} of ${totalQuestions}</span>
                    </div>
                    <div class="question-text">${question.text}</div>
                    <textarea class="answer-input" id="answerInput" placeholder="Type your answer here..." ${isAnswered ? 'disabled' : ''}>${answers[question.id] || ''}</textarea>

                    <div class="button-group">
                        ${!isAnswered
                    ? `<button class="submit-btn" onclick="submitAnswer('${question.text.replace(/'/g, "\\'")}', ${question.id})">Submit Answer</button>`
                    : `<button class="next-btn" onclick="nextQuestion()">Next Question â†’</button>`
                }
                    </div>

                    <div class="feedback-section ${feedbacks[question.id] ? 'active' : ''}" id="feedbackSection">
                        <div class="feedback-header">
                            <span>ðŸ‘” Interviewer's Feedback</span>
                        </div>
                        <div class="feedback-content" id="feedbackContent">${feedbacks[question.id] || ''}</div>
                    </div>
                </div>
            `;
            updateProgress();
        }

        async function submitAnswer(questionText, questionId) {
            const answer = document.getElementById('answerInput').value.trim();

            if (!answer) {
                showError('Please type your answer before submitting.');
                return;
            }

            if (answer.length < 15) {
                showError('Please provide a more detailed answer.');
                return;
            }

            const submitBtn = document.querySelector('.submit-btn');
            submitBtn.innerHTML = '<span class="loading-spinner"></span> Evaluating...';
            submitBtn.disabled = true;

            try {
                const prompt = `You are a professional interviewer. Evaluate this interview answer specifically for a ${careerGoal} role.
                
                Question: "${questionText}"
                Answer: "${answer}"
                
                Provide feedback in this format:
                SCORE: [number/100]
                RATING: [Excellent/Good/Needs Improvement]
                STRENGTHS: [Bullet points]
                AREAS FOR IMPROVEMENT: [Bullet points]
                TIPS: [Actionable tips]`;

                const feedback = await callGemini(prompt, 400, 0.4);

                const scoreMatch = feedback.match(/SCORE:\s*(\d+)/i);
                const score = scoreMatch ? parseInt(scoreMatch[1]) : 70;

                answers[questionId] = answer;
                scores[questionId] = score;
                feedbacks[questionId] = feedback.replace(/\n/g, '<br>');

                updateScoreDisplay();

                // Re-render with feedback and Next button
                renderQuestion(currentQuestionIndex, { id: questionId, text: questionText });

            } catch (error) {
                console.error('Evaluation failed:', error);
                showError('Connection timeout. Using simplified evaluation.');

                answers[questionId] = answer;
                scores[questionId] = 65;
                feedbacks[questionId] = "Good effort! Try to add more specific examples to your responses.";

                updateScoreDisplay();
                renderQuestion(currentQuestionIndex, { id: questionId, text: questionText });
            }
        }

        function nextQuestion() {
            currentQuestionIndex++;
            generateAndLoadQuestion(currentQuestionIndex);
        }

        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / totalQuestions) * 100;
            const fill = document.getElementById('progressFill');
            const text = document.getElementById('currentQuestionDisplay');
            if (fill) fill.style.width = progress + '%';
            if (text) text.textContent = `Question ${currentQuestionIndex + 1} of ${totalQuestions}`;
        }

        function updateScoreDisplay() {
            const answeredScores = Object.values(scores);
            const scoreEl = document.getElementById('scoreDisplay');
            if (answeredScores.length > 0 && scoreEl) {
                const avg = Math.round(answeredScores.reduce((a, b) => a + b, 0) / answeredScores.length);
                scoreEl.textContent = `Current Avg: ${avg}/100`;
            }
        }

        function showFinalScore() {
            const totalScore = Object.values(scores).reduce((a, b) => a + b, 0);
            const avg = Math.round(totalScore / totalQuestions);

            const finalScoreEl = document.getElementById('finalScore');
            const scoreMsgEl = document.getElementById('scoreMessage');
            const scoreCard = document.getElementById('scoreCard');
            const finalBtn = document.getElementById('finalScoreBtn');

            if (finalScoreEl) finalScoreEl.textContent = avg;
            if (scoreMsgEl) {
                if (avg >= 85) scoreMsgEl.textContent = 'ðŸŒŸ Outstanding! You are highly prepared.';
                else if (avg >= 70) scoreMsgEl.textContent = 'ðŸ‘ Good work! Just a few more refinements needed.';
                else scoreMsgEl.textContent = 'ðŸŽ¯ Keep practicing! You are getting better every day.';
            }

            if (scoreCard) scoreCard.classList.add('active');
            if (finalBtn) finalBtn.style.display = 'none';
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.classList.add('active');
                setTimeout(() => errorDiv.classList.remove('active'), 3000);
            }
        }

        function showFinalScore() {
            if (Object.keys(scores).length < questions.length) {
                showError('Please answer all questions first.');
                return;
            }

            const totalScore = Object.values(scores).reduce((a, b) => a + b, 0);
            const avg = Math.round(totalScore / questions.length);

            document.getElementById('finalScore').textContent = avg;

            let message = '';
            if (avg >= 90) message = 'ðŸŒŸ Outstanding! You are extremely well-prepared for interviews.';
            else if (avg >= 80) message = 'ðŸ‘ Very good! You are well-prepared for most interviews.';
            else if (avg >= 70) message = 'ðŸ“ˆ Good job! Practice more on your weaker areas.';
            else if (avg >= 60) message = 'ðŸ’ª You\'re on the right track. Keep practicing!';
            else message = 'ðŸŽ¯ Keep practicing! Focus on structure and examples.';

            document.getElementById('scoreMessage').textContent = message;
            document.getElementById('scoreCard').classList.add('active');
            document.getElementById('finalScoreBtn').style.display = 'none';
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.add('active');
            setTimeout(() => errorDiv.classList.remove('active'), 3000);
        }
    </script>
</body>

</html>