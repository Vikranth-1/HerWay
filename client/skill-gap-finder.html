<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HerWay | Skill Gap Finder</title>
    <link rel="stylesheet" href="style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&family=Playfair+Display:ital,wght@0,700;1,700&display=swap"
        rel="stylesheet">
    <style>
        /* â”€â”€ Assessment Styles â”€â”€ */
        .assessment-container {
            max-width: 800px;
            margin: 1rem auto;
            padding: 2rem;
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            border-radius: 24px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
        }

        .greeting-section {
            text-align: center;
            margin-bottom: 2rem;
        }

        .greeting-text {
            font-family: 'Playfair Display', serif;
            color: var(--terracotta);
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            min-height: 50px;
            line-height: 1.4;
        }

        .start-button {
            background: var(--grad-primary);
            color: white;
            padding: 1rem 3rem;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 8px 25px rgba(244, 114, 141, 0.3);
            letter-spacing: 0.5px;
        }

        .start-button:hover {
            transform: translateY(-3px) scale(1.03);
            box-shadow: 0 12px 35px rgba(244, 114, 141, 0.4);
        }

        .start-button:active {
            transform: translateY(0) scale(1);
        }

        /* â”€â”€ Assessment Section â”€â”€ */
        .assessment-section {
            display: none;
        }

        .assessment-section.active {
            display: block;
            animation: fadeSlideIn 0.5s ease forwards;
        }

        @keyframes fadeSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(244, 114, 141, 0.15);
            border-radius: 10px;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--grad-primary);
            width: 0%;
            border-radius: 10px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .question-counter {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-bottom: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        .question-text {
            color: var(--secondary);
            font-family: 'Playfair Display', serif;
            font-size: 1.35rem;
            font-weight: 600;
            margin-bottom: 2rem;
            line-height: 1.7;
        }

        .answer-area {
            margin-bottom: 2rem;
        }

        .answer-label {
            font-weight: 700;
            color: var(--terracotta);
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .answer-input {
            width: 100%;
            padding: 1.2rem;
            border: 2px solid var(--glass-border);
            border-radius: 16px;
            font-size: 1rem;
            font-family: 'Outfit', sans-serif;
            resize: vertical;
            min-height: 120px;
            background: rgba(255, 255, 255, 0.6);
            color: var(--secondary);
            transition: all 0.3s ease;
        }

        .answer-input:focus {
            outline: none;
            border-color: var(--terracotta);
            box-shadow: 0 0 0 4px rgba(244, 114, 141, 0.12);
            background: white;
        }

        .answer-input::placeholder {
            color: var(--text-muted);
            opacity: 0.6;
        }

        .submit-button {
            background: var(--grad-primary);
            color: white;
            padding: 0.9rem 2.5rem;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 0.75rem;
            box-shadow: 0 6px 20px rgba(244, 114, 141, 0.25);
        }

        .submit-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(244, 114, 141, 0.35);
        }

        .submit-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* â”€â”€ Answer Display â”€â”€ */
        .answer-display {
            background: rgba(244, 114, 141, 0.06);
            border-left: 4px solid var(--terracotta);
            padding: 1.2rem 1.5rem;
            margin-bottom: 1.25rem;
            border-radius: 0 12px 12px 0;
            display: none;
        }

        .answer-display.active {
            display: block;
            animation: fadeSlideIn 0.3s ease;
        }

        .answer-display-label {
            font-weight: 700;
            color: var(--terracotta);
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .answer-display-content {
            color: var(--secondary);
            line-height: 1.7;
            white-space: pre-wrap;
        }

        /* â”€â”€ Assessment Result â”€â”€ */
        .assessment-result {
            background: rgba(16, 185, 129, 0.08);
            border-left: 4px solid var(--success);
            padding: 1.2rem 1.5rem;
            margin-bottom: 1.25rem;
            border-radius: 0 12px 12px 0;
            display: none;
        }

        .assessment-result.active {
            display: block;
            animation: fadeSlideIn 0.3s ease;
        }

        .assessment-result.incorrect {
            background: rgba(239, 68, 68, 0.08);
            border-left-color: #ef4444;
        }

        .assessment-label {
            font-weight: 700;
            color: var(--success);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .assessment-result.incorrect .assessment-label {
            color: #ef4444;
        }

        .assessment-content {
            color: var(--secondary);
            line-height: 1.7;
            white-space: pre-wrap;
            font-size: 0.95rem;
        }

        .feedback-text {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-top: 0.75rem;
            font-style: italic;
        }

        /* â”€â”€ Buttons â”€â”€ */
        .button-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1.5rem;
        }

        .next-button {
            background: var(--grad-primary);
            color: white;
            padding: 0.8rem 2.5rem;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(244, 114, 141, 0.25);
        }

        .next-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(244, 114, 141, 0.35);
        }

        .next-button:disabled {
            background: #ddd;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* â”€â”€ Results Section â”€â”€ */
        .results-section {
            display: none;
            text-align: center;
        }

        .results-section.active {
            display: block;
            animation: fadeSlideIn 0.6s ease;
        }

        .score-display {
            font-size: 5rem;
            font-weight: 700;
            font-family: 'Playfair Display', serif;
            background: var(--grad-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 2rem 0;
        }

        .score-label {
            font-size: 1.5rem;
            color: var(--secondary);
            margin-bottom: 1rem;
            font-family: 'Playfair Display', serif;
        }

        .score-description {
            color: var(--text-muted);
            font-size: 1.05rem;
            line-height: 1.8;
            margin-bottom: 2rem;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .results-button {
            background: var(--grad-primary);
            color: white;
            padding: 1rem 3rem;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(244, 114, 141, 0.3);
        }

        .results-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(244, 114, 141, 0.4);
        }

        /* â”€â”€ Loading â”€â”€ */
        .loading-spinner {
            display: inline-block;
            width: 28px;
            height: 28px;
            border: 3px solid rgba(244, 114, 141, 0.2);
            border-top: 3px solid var(--terracotta);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0.75rem 0;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* â”€â”€ Error â”€â”€ */
        .error-message {
            background: rgba(239, 68, 68, 0.08);
            border-left: 4px solid #ef4444;
            padding: 1rem 1.25rem;
            margin-bottom: 1.25rem;
            border-radius: 0 12px 12px 0;
            color: #ef4444;
            font-weight: 500;
            display: none;
        }

        .error-message.active {
            display: block;
            animation: fadeSlideIn 0.3s ease;
        }

        /* â”€â”€ Hero Agent â”€â”€ */
        .agent-hero {
            text-align: center;
            margin-bottom: 2rem;
        }

        .agent-hero .glow {
            width: 140px;
            height: 140px;
            background: var(--grad-primary);
            border-radius: 50%;
            margin: 0 auto;
            filter: blur(20px);
            opacity: 0.5;
            animation: pulse 3s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.5;
            }

            50% {
                transform: scale(1.1);
                opacity: 0.7;
            }
        }

        .agent-hero img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin-top: -130px;
            position: relative;
            border: 4px solid white;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>
    <canvas id="bg"></canvas>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-area" onclick="window.location.href='index.html'" style="cursor: pointer;">
                <img src="logo1.jpeg" alt="Her Way Logo" class="logo">
                <div class="logo-text-group">
                    <span class="brand-name" data-i18n="brand_name">Her Way</span>
                    <span class="tagline" data-i18n="tagline_main">"Empower. Equip. Elevate."</span>
                </div>
            </div>
            <nav class="header-nav">
                <a href="index.html" class="nav-link" data-i18n="home_btn">Home</a>
            </nav>
            <div class="header-right">
                <div id="google_translate_element"></div>
                <div class="user-control">
                    <span id="user-name-display" class="user-greeting"></span>
                    <button class="nav-icon profile-trigger" title="Profile">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                        </svg>
                    </button>
                    <button class="nav-icon logout-btn" title="Logout"
                        onclick="localStorage.removeItem('loggedInUser'); window.location.href='login.html'">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="assessment-container">
            <!-- Agent Hero -->
            <div class="agent-hero">
                <div class="glow"></div>
                <img src="Skill_Gap_logo.png" alt="Skill Gap Logo">
            </div>

            <h2 style="text-align: center; font-family: 'Playfair Display', serif; font-size: 2.2rem; color: var(--secondary); margin-bottom: 0.5rem;"
                data-i18n="skill_gap_finder_title">Skill Gap Finder</h2>
            <p style="text-align: center; color: var(--text-muted); margin-bottom: 2rem;">Powered by AI â€” Discover your
                strengths & areas to grow</p>

            <!-- Greeting Section -->
            <div class="greeting-section" id="greetingSection">
                <div class="greeting-text" id="greetingText">Loading greeting...</div>
                <button class="start-button" id="startBtn" onclick="startAssessment()">Start Assessment</button>
            </div>

            <!-- Assessment Section -->
            <div class="assessment-section" id="assessmentSection">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>

                <div class="question-counter" id="questionCounter">Question 1 of 10</div>
                <div class="question-text" id="questionText">Loading question...</div>

                <div class="error-message" id="errorMessage"></div>

                <div class="answer-area">
                    <div class="answer-label">Your Answer:</div>
                    <textarea class="answer-input" id="answerInput" placeholder="Type your answer here..."></textarea>
                    <button class="submit-button" id="submitBtn" onclick="submitAnswer()">Submit Answer</button>
                </div>

                <div class="answer-display" id="answerDisplay">
                    <div class="answer-display-label">Your Answer:</div>
                    <div class="answer-display-content" id="answerContent"></div>
                </div>

                <div class="assessment-result" id="assessmentResult">
                    <div class="assessment-label" id="assessmentLabel">Assessment:</div>
                    <div class="assessment-content" id="assessmentContent"></div>
                    <div class="feedback-text" id="feedbackText"></div>
                </div>

                <div class="button-group">
                    <button class="next-button" id="nextBtn" disabled onclick="nextQuestion()">Next Question â†’</button>
                </div>
            </div>

            <!-- Results Section -->
            <div class="results-section" id="resultsSection">
                <h2
                    style="color: var(--terracotta); margin-bottom: 1.5rem; font-family: 'Playfair Display', serif; font-size: 2rem;">
                    Assessment Complete! ðŸŽ‰</h2>
                <div class="score-label">Your Score</div>
                <div class="score-display" id="finalScore">0%</div>
                <div class="score-description" id="scoreDescription">
                    Great effort! Check your detailed results below.
                </div>
                <button class="results-button" onclick="window.location.href='index.html'">Back to Home</button>
            </div>
        </div>
    </main>

    <script type="module" src="app.js"></script>
    <script>
        // â”€â”€ Secure: All Gemini calls routed through backend proxy â”€â”€
        const API_BASE = window.location.hostname === 'localhost'
            ? 'http://localhost:5000'
            : '';

        async function callGemini(prompt, maxOutputTokens = 200, temperature = 0.7) {
            const response = await fetch(`${API_BASE}/api/gemini/generate`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt, maxOutputTokens, temperature })
            });
            if (!response.ok) throw new Error(`Server error: ${response.status}`);
            const data = await response.json();
            return data.text || '';
        }

        let currentQuestion = 0;
        let totalQuestions = 5;
        let score = 0;
        let assessmentAnswers = [];
        let userSkills = "";
        let careerGoal = "";

        // Initialize on page load
        window.addEventListener('load', async () => {
            const user = JSON.parse(localStorage.getItem('loggedInUser') || '{}');
            userSkills = Array.isArray(user.skills) ? user.skills.join(', ') : (user.skills || "");
            careerGoal = user.career_goal || localStorage.getItem('targetCareer') || "General Growth";

            const userNameEl = document.getElementById('user-name-display');
            if (userNameEl && user.name) userNameEl.textContent = user.name;

            await generateGreeting();
        });

        async function generateGreeting() {
            try {
                const prompt = `Generate a warm, encouraging greeting for ${careerGoal ? 'a woman pursuing ' + careerGoal : 'a woman starting her career journey'}. 
                Keep it short (1-2 sentences) and motivational. Just return the greeting text only.`;
                const greeting = await callGemini(prompt, 100, 0.7);
                document.getElementById('greetingText').textContent = greeting || "Welcome! Let's discover your unique strengths and growth areas.";
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('greetingText').textContent = "Welcome, Queen! Ready to discover your strengths? Let's begin! âœ¨";
            }
        }

        function startAssessment() {
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('greetingText').style.display = 'none';
            document.getElementById('assessmentSection').classList.add('active');
            generateQuestion();
        }

        async function generateQuestion() {
            try {
                document.getElementById('questionText').innerHTML = '<div class="loading-spinner"></div>';
                document.getElementById('answerInput').value = '';
                document.getElementById('submitBtn').disabled = false;
                document.getElementById('answerInput').disabled = false;

                const historyList = assessmentAnswers.map(a => a.question);
                let question = "";
                let attempts = 0;
                const maxAttempts = 3;

                while (attempts < maxAttempts) {
                    const prompt = `You are a professional AI Career Coach for ${careerGoal}.
                    TASK: Generate ONE unique skill assessment question.
                    CONTEXT: User has skills [${userSkills}] and wants to be a [${careerGoal}].
                    STRICT RULE: Do NOT generate any of these previous questions:
                    ${historyList.length > 0 ? historyList.map((q, i) => `${i + 1}. ${q}`).join('\n') : 'None yet'}
                    
                    REQUIREMENT: The question must test a different specific technical or soft skill required for ${careerGoal} than the ones already tested.
                    REPLY WITH ONLY THE QUESTION TEXT. NO EXPLANATIONS.`;

                    const response = await callGemini(prompt, 150, 0.8);
                    const cleanedResponse = response.trim();

                    // Client-side uniqueness check
                    const isDuplicate = historyList.some(prev =>
                        cleanedResponse.toLowerCase() === prev.toLowerCase() ||
                        cleanedResponse.includes(prev.substring(0, 20)) ||
                        prev.includes(cleanedResponse.substring(0, 20))
                    );

                    if (!isDuplicate && cleanedResponse.length > 10) {
                        question = cleanedResponse;
                        break;
                    }
                    attempts++;
                    console.warn(`Duplicate or invalid question detected. Attempt ${attempts} of ${maxAttempts}`);
                }

                document.getElementById('questionText').textContent = question || "How do you handle complex tasks when working under a deadline?";
                updateProgressBar();
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('questionText').textContent = "Tell us about a time you had to learn a new skill quickly for a project.";
                updateProgressBar();
            }
        }

        function submitAnswer() {
            const answer = document.getElementById('answerInput').value.trim();

            if (!answer) {
                showError('Please enter an answer before submitting.');
                return;
            }

            if (answer.length < 15) {
                showError('Please provide a more detailed answer.');
                return;
            }

            document.getElementById('answerInput').disabled = true;
            document.getElementById('submitBtn').disabled = true;

            document.getElementById('answerContent').textContent = answer;
            document.getElementById('answerDisplay').classList.add('active');

            document.getElementById('assessmentContent').innerHTML = '<div class="loading-spinner"></div> Evaluating your answer...';
            document.getElementById('assessmentResult').classList.add('active');
            document.getElementById('assessmentResult').classList.remove('incorrect');

            assessAnswer(answer);
        }

        async function assessAnswer(answer) {
            try {
                const question = document.getElementById('questionText').textContent;

                const prompt = `Evaluate this answer for a potential ${careerGoal}.
                Question: "${question}"
                Answer: "${answer}"
                
                Provide evaluation in this exact format:
                RESULT: [CORRECT/INCORRECT]
                SCORE: [1-10]
                FEEDBACK: [2-3 sentences of professional advice]`;

                const assessment = await callGemini(prompt, 250, 0.3);

                const isCorrect = assessment.toUpperCase().includes('RESULT: CORRECT');
                const scoreMatch = assessment.match(/SCORE:\s*(\d+)/i);
                const qScore = scoreMatch ? parseInt(scoreMatch[1]) : (isCorrect ? 8 : 4);

                if (isCorrect) {
                    score += qScore;
                    document.getElementById('assessmentResult').classList.remove('incorrect');
                    document.getElementById('assessmentLabel').textContent = `âœ“ Strong Answer! (${qScore}/10)`;
                } else {
                    document.getElementById('assessmentResult').classList.add('incorrect');
                    document.getElementById('assessmentLabel').textContent = `âœ— Growth Area Identified (${qScore}/10)`;
                }

                document.getElementById('assessmentContent').textContent = assessment.includes('FEEDBACK:') ? assessment.split('FEEDBACK:')[1].trim() : assessment;
                document.getElementById('nextBtn').disabled = false;

                assessmentAnswers.push({ question, answer, score: qScore, isCorrect });

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('assessmentLabel').textContent = 'âœ“ Answer Received';
                document.getElementById('assessmentContent').textContent = 'Good effort! We are recording your response for your roadmap.';
                document.getElementById('nextBtn').disabled = false;
                assessmentAnswers.push({
                    question: document.getElementById('questionText').textContent,
                    answer,
                    score: 7,
                    isCorrect: true
                });
            }
        }

        function nextQuestion() {
            currentQuestion++;

            if (currentQuestion < totalQuestions) {
                resetAnswer();
                document.getElementById('answerDisplay').classList.remove('active');
                document.getElementById('assessmentResult').classList.remove('active');
                document.getElementById('nextBtn').disabled = true;
                document.getElementById('answerInput').disabled = false;
                document.getElementById('submitBtn').disabled = false;
                generateQuestion();
            } else {
                showResults();
            }
        }

        function updateProgressBar() {
            const progress = ((currentQuestion) / totalQuestions) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('questionCounter').textContent = `Question ${currentQuestion + 1} of ${totalQuestions}`;
        }

        function resetAnswer() {
            document.getElementById('answerInput').value = '';
            document.getElementById('answerInput').disabled = false;
            document.getElementById('submitBtn').disabled = false;
        }

        async function showResults() {
            document.getElementById('assessmentSection').classList.remove('active');
            document.getElementById('resultsSection').classList.add('active');

            const maxPossible = totalQuestions * 10;
            const percentage = Math.round((score / maxPossible) * 100);
            document.getElementById('finalScore').textContent = percentage + '%';

            let description = '';
            if (percentage >= 90) description = 'ðŸŒŸ Exceptional! You have outstanding knowledge in this area. You\'re ready to lead!';
            else if (percentage >= 70) description = 'ðŸ’ª Great foundation! Just a few specialized skills to polish.';
            else if (percentage >= 50) description = 'ðŸ“š Good start! We have identified specific gaps to help you grow.';
            else description = 'ðŸŒ± Every expert starts here. Your custom roadmap will bridge these gaps!';

            document.getElementById('scoreDescription').textContent = description;

            // Save to database
            const user = JSON.parse(localStorage.getItem('loggedInUser') || '{}');
            if (user.id) {
                document.getElementById('scoreDescription').innerHTML += '<br><br><div class="loading-spinner"></div> Updating your roadmap...';
                await saveAndGenerateRoadmap(user.id, percentage);
                document.getElementById('scoreDescription').innerHTML = description + '<br><br>âœ… Roadmap updated based on your gaps!';
            }
        }

        async function saveAndGenerateRoadmap(userId, finalScore) {
            try {
                // 1. Save Session
                const results = assessmentAnswers.map(a => ({
                    question: a.question,
                    answer: a.answer,
                    score: a.score
                }));

                await fetch(`${API_BASE}/api/skill-gap/save`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId,
                        careerIntent: careerGoal,
                        sessionData: results,
                        totalScore: finalScore
                    })
                });

                // 2. Generate Roadmap
                await fetch(`${API_BASE}/api/roadmap/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId,
                        careerIntent: careerGoal,
                        results: results
                    })
                });
            } catch (err) {
                console.error('Failed to update roadmap:', err);
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.add('active');
            setTimeout(() => errorDiv.classList.remove('active'), 4000);
        }

        // Allow Enter key to submit (Shift+Enter for new line)
        document.addEventListener('keydown', function (event) {
            if (event.key === 'Enter' && !event.shiftKey && document.activeElement === document.getElementById('answerInput')) {
                event.preventDefault();
                if (!document.getElementById('submitBtn').disabled) {
                    submitAnswer();
                }
            }
        });
    </script>
    <script type="module" src="app.js"></script>
</body>

</html>